<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>예보 시간 확인</title>
</head>
<body>
  <h1>예보 데이터 시각 확인</h1>
  <pre id="output">불러오는 중...</pre>

  <script>
    const serviceKey = 'UX0oUh7ZWRuQW2qnng2rzw8U14zs2TmY9DYi8Eqs0SDQpo1wMe0l/BtVqaYcl7LYEJP0wysrk3xmQFgeE5iTJQ==
';
    const nx = 60, ny = 120;

    function formatDate(date) {
      const yyyy = date.getFullYear();
      const mm = String(date.getMonth() + 1).padStart(2, '0');
      const dd = String(date.getDate()).padStart(2, '0');
      return `${yyyy}${mm}${dd}`;
    }

    function getBaseTime() {
      const hour = new Date().getHours();
      if (hour < 2) return "2300";
      if (hour < 5) return "0200";
      if (hour < 8) return "0500";
      if (hour < 11) return "0800";
      if (hour < 14) return "1100";
      if (hour < 17) return "1400";
      if (hour < 20) return "1700";
      if (hour < 23) return "2000";
      return "2300";
    }

    async function checkForecastTimes() {
      const base_date = formatDate(new Date());
      const base_time = getBaseTime();
      const url = `https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst?serviceKey=${serviceKey}&pageNo=1&numOfRows=1000&dataType=JSON&base_date=${base_date}&base_time=${base_time}&nx=${nx}&ny=${ny}`;

      try {
        const res = await fetch(url);
        const json = await res.json();
        const items = json.response.body.items.item;

        const times = Array.from(new Set(items.map(i => `${i.fcstDate} ${i.fcstTime}`))).sort();
        const output = times.join('\n');
        document.getElementById('output').textContent = `▶ 현재 base_date=${base_date}, base_time=${base_time}\n\n${output}`;
      } catch (e) {
        document.getElementById('output').textContent = "API 호출 실패: " + e.message;
      }
    }

    checkForecastTimes();
  </script>
</body>
</html>
